(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function c(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(r){if(r.ep)return;r.ep=!0;const n=c(r);fetch(r.href,n)}})();const u="yuhueiorder";let f=[];const m=document.querySelector(".productWrap");function g(t){const o=document.createElement("li");o.className="productCard";const c=document.createElement("h4");c.className="productType",c.innerText="新品";const e=document.createElement("img");e.src=t.images;const r=document.createElement("a");r.className="addCardBtn",r.innerText="加入購物車",r.dataset.id=t.id;const n=document.createElement("h3");n.innerText=t.title;const a=document.createElement("del");a.className="originPrice",a.innerText=`NT$${t.origin_price}`;const d=document.createElement("p");return d.className="nowPrice",d.innerText=`NT$${t.price}`,o.append(c,e,r,n,a,d),o}async function T(){try{const t=`https://livejs-api.hexschool.io/api/livejs/v1/customer/${u}/products`;f=(await axios.get(t)).data.products,f.forEach(c=>{const e=g(c);m.appendChild(e),e.querySelector(".addCardBtn").addEventListener("click",y)})}catch(t){console.error("Error during get products:",t.response.data.message)}}const x=document.querySelector(".productDisplay");x.addEventListener("change",function(o){o.target.value==="全部"?(m.innerHTML="",f.forEach(c=>{const e=g(c);m.appendChild(e),e.querySelector(".addCardBtn").addEventListener("click",y)})):(m.innerHTML="",f.filter(e=>e.category.includes(o.target.value)).forEach(e=>{const r=g(e);m.appendChild(r),r.querySelector(".addCardBtn").addEventListener("click",y)}))});let s=[];function C(t){const o=document.createElement("tr");o.className="cartItem-list";const c=document.createElement("td"),e=document.createElement("div");e.className="cardItem-title";const r=document.createElement("img");r.src=t.product.images;const n=document.createElement("p");n.innerText=t.product.title,e.append(r,n),c.appendChild(e);const a=document.createElement("td");a.innerText=`NT$${t.product.origin_price}`;const d=document.createElement("td");d.innerText=t.quantity;const i=document.createElement("td");i.innerText=`NT$${t.product.price}`;const l=document.createElement("td");return l.className="discardBtn",l.innerHTML="<a class='material-icons'>clear</a>",l.dataset.id=t.id,o.append(c,a,d,i,l),o}const h=document.querySelector(".shoppingCart-table"),v=h.getElementsByTagName("tr"),I=v.length-2;v[I];async function N(){try{const t=`https://livejs-api.hexschool.io/api/livejs/v1/customer/${u}/carts`;s=(await axios.get(t)).data,p(s)}catch(t){console.error("Error during get carts:",t.response.data.message)}}function p(t){h.innerHTML=`<tr>
                                  <th width="40%">品項</th>
                                  <th width="15%">單價</th>
                                  <th width="15%">數量</th>
                                  <th width="15%">金額</th>
                                  <th width="15%"></th>
                                </tr>`,t.carts.forEach(l=>{const E=C(l);h.append(E),E.querySelector(".discardBtn").addEventListener("click",P)});const o=document.createElement("tr"),c=document.createElement("td"),e=document.createElement("a");e.className="discardAllBtn",e.innerText="刪除所有品項",e.addEventListener("click",q),c.appendChild(e);const r=document.createElement("td"),n=document.createElement("td"),a=document.createElement("td"),d=document.createElement("p");d.innerText="總金額",a.appendChild(d);const i=document.createElement("td");i.className="total-price",i.innerText=`NT$${t.finalTotal}`,o.append(c,r,n,a,i),h.appendChild(o),console.log(t)}async function y(t){const c=t.currentTarget.dataset.id;if(!c){console.error("無法取得商品 ID");return}try{let e={data:{productId:c,quantity:1}};const r=`https://livejs-api.hexschool.io/api/livejs/v1/customer/${u}/carts`;let n=s.carts.find(a=>a.product.id===c);n?(e.data.quantity=n.quantity+1,e.data.id=n.id,s=(await axios.patch(r,e)).data,p(s)):(s=(await axios.post(r,e)).data,p(s))}catch(e){console.error("Error during addToCart:",e.response.data.message)}}async function q(){try{const t=`https://livejs-api.hexschool.io/api/livejs/v1/customer/${u}/carts`;s=(await axios.delete(t)).data,alert(s.message),p(s)}catch(t){console.error("Error during clear cart:",t.response.data.message)}}async function P(t){const c=t.currentTarget.dataset.id;try{const e=`https://livejs-api.hexschool.io/api/livejs/v1/customer/${u}/carts/${c}`;s=(await axios.delete(e)).data,p(s)}catch(e){console.error("Error during remove cart product:",e.response.data.message)}}const w=document.querySelector("#customerName"),L=document.querySelector("#customerPhone"),B=document.querySelector("#customerEmail"),$=document.querySelector("#customerAddress"),S=document.querySelector("#tradeWay");function j(){return{data:{user:{name:w.value,tel:L.value,email:B.value,address:$.value,payment:S.value}}}}function R(){const t=document.querySelectorAll(".orderInfo-formGroup");let o=!0;for(const c of t){const e=c.querySelector("input");e&&e.value.trim()===""&&(alert(`${e.name}不得為空`),o=!1)}return o}async function b(){console.log("submit");const t=j();if(console.log(t),R())try{console.log("try");const o=`https://livejs-api.hexschool.io/api/livejs/v1/customer/${u}/orders`,c=await axios.post(o,t);alert("已送出訂單"),document.querySelector(".orderInfo-form").reset()}catch(o){console.error("Error during create order:",o.response.data.message)}}const O=document.querySelector(".orderInfo-btn");O.addEventListener("click",b);function A(){T(),N()}A();
